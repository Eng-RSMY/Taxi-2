<?php

namespace FunPro\ServiceBundle\Repository;

use Doctrine\ORM\EntityRepository;
use Doctrine\ORM\NonUniqueResultException;
use Doctrine\ORM\NoResultException;
use FunPro\ServiceBundle\Entity\Service;

/**
 * ServiceLogRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ServiceLogRepository extends EntityRepository
{
    /**
     * @param Service $service
     *
     * @throws NoResultException
     *
     * @return array
     */
    public function getLastLog(Service $service)
    {
        $queryBuilder = $this->createQueryBuilder('s');

        return $queryBuilder->where($queryBuilder->expr()->eq('s.service', ':service'))
            ->orderBy('s.atTime', 'DESC')
            ->setParameter('service', $service)
            ->getQuery()
            ->getMaxResults(1)
            ->getSingleResult();
    }
}
